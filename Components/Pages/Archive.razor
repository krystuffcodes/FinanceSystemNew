@page "/archive"
@using System.ComponentModel.DataAnnotations

<PageTitle>Archive Management - Fortress Finance</PageTitle>

<div class="archive-management-container">
    <!-- Header -->
    <div class="archive-header">
        <h1>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="21,8 21,21 3,21 3,8"/>
                <rect x="1" y="3" width="22" height="5"/>
                <line x1="10" y1="12" x2="14" y2="12"/>
            </svg>
            Archive Management
        </h1>
        <div class="user-info">
            <div class="user-avatar">A</div>
            <div class="user-details">
                <span class="user-name">Admin User</span>
                <span class="user-role">Administrator</span>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <button class="tab-btn @(activeTab == "customers" ? "active" : "")" @onclick="@(() => SetActiveTab("customers"))">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            ?? Customers (@GetArchivedCustomersCount())
        </button>
        <button class="tab-btn @(activeTab == "loans" ? "active" : "")" @onclick="@(() => SetActiveTab("loans"))">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                <line x1="12" y1="18" x2="12" y2="22"/>
            </svg>
            ?? Loans (@GetArchivedLoansCount())
        </button>
        <button class="tab-btn @(activeTab == "payments" ? "active" : "")" @onclick="@(() => SetActiveTab("payments"))">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
            </svg>
            ?? Payments (@GetArchivedPaymentsCount())
        </button>
    </div>

    @if (activeTab == "customers")
    {
        <!-- Customer Archive Content -->
        <div class="archive-content">
            <!-- Enhanced Search and Filters Section -->
            <div class="archive-controls">
                <div class="search-section">
                    <div class="search-container">
                        <span class="search-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="21 21l-4.35-4.35"/>
                            </svg>
                        </span>
                        <input type="text" placeholder="Search customers by name, email, or ID..." @bind="customerSearchTerm" @oninput="HandleCustomerSearch" class="search-input" />
                    </div>
                </div>
                
                <div class="filter-group">
                    <div class="filter-section">
                        <label>EMPLOYMENT</label>
                        <select @bind="selectedEmployment" class="filter-select">
                            <option value="All Employment">All Employment</option>
                            <option value="Employed">Employed</option>
                            <option value="Self-Employed">Self-Employed</option>
                            <option value="Unemployed">Unemployed</option>
                            <option value="Retired">Retired</option>
                        </select>
                    </div>
                    
                    <div class="filter-section">
                        <label>LOAN STATUS</label>
                        <select @bind="selectedLoanStatus" class="filter-select">
                            <option value="All Loan Status">All Loan Status</option>
                            <option value="Completed">Completed</option>
                            <option value="Defaulted">Defaulted</option>
                            <option value="Closed">Closed</option>
                        </select>
                    </div>
                    
                    <div class="filter-section">
                        <label>ARCHIVE PERIOD</label>
                        <select @bind="selectedArchivePeriod" class="filter-select">
                            <option value="All Archive Period">All Archive Period</option>
                            <option value="This Month">This Month</option>
                            <option value="Last 3 Months">Last 3 Months</option>
                            <option value="Last 6 Months">Last 6 Months</option>
                            <option value="Last Year">Last Year</option>
                        </select>
                    </div>
                </div>
                
                <div class="actions-section">
                    <button class="btn btn-primary btn-medium" @onclick="ExportArchiveData">
                        <span class="btn-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </span>
                        Export
                    </button>
                    <button class="btn btn-secondary btn-medium" @onclick="RestoreSelected">
                        <span class="btn-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23,4 23,10 17,10"/>
                                <polyline points="1,20 1,14 7,14"/>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                            </svg>
                        </span>
                        Restore
                    </button>
                    <button class="btn btn-outline btn-medium" @onclick="RefreshArchive">
                        <span class="btn-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23,4 23,10 17,10"/>
                                <polyline points="1,20 1,14 7,14"/>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                            </svg>
                        </span>
                        Refresh
                    </button>
                </div>
            </div>

            @if (isLoading)
            {
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <span>Loading archived customers...</span>
                </div>
            }
            else if (!GetFilteredCustomers().Any())
            {
                <div class="empty-container">
                    <div class="empty-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="21,8 21,21 3,21 3,8"/>
                            <rect x="1" y="3" width="22" height="5"/>
                            <line x1="10" y1="12" x2="14" y2="12"/>
                        </svg>
                    </div>
                    <h4>No archived customers</h4>
                    <p>There are no archived customers at the moment.</p>
                </div>
            }
            else
            {
                <!-- Customer Archive Table -->
                <div class="table-section">
                    <div class="table-header">
                        <h3>Archived Customers (@GetFilteredCustomers().Count)</h3>
                        <div class="table-actions">
                            <div class="view-toggle">
                                <button class="toggle-btn @(viewMode == "table" ? "active" : "")" @onclick="@(() => SetViewMode("table"))">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h4"/>
                                    </svg>
                                    Table
                                </button>
                                <button class="toggle-btn @(viewMode == "cards" ? "active" : "")" @onclick="@(() => SetViewMode("cards"))">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="7" height="7"/>
                                        <rect x="14" y="3" width="7" height="7"/>
                                        <rect x="14" y="14" width="7" height="7"/>
                                        <rect x="3" y="14" width="7" height="7"/>
                                    </svg>
                                    Cards
                                </button>
                            </div>
                            <select value="@pageSize" @onchange="UpdatePageSize" class="page-size-select">
                                <option value="5">5 per page</option>
                                <option value="10">10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                            </select>
                        </div>
                    </div>

                    @if (viewMode == "table")
                    {
                        <!-- Table View -->
                        <div class="table-container">
                            <table class="archive-table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" @onchange="SelectAll" />
                                        </th>
                                        <th @onclick="@(() => SortBy("Name"))">
                                            Customer @GetSortIcon("Name")
                                        </th>
                                        <th @onclick="@(() => SortBy("Employment"))">
                                            Employment @GetSortIcon("Employment")
                                        </th>
                                        <th @onclick="@(() => SortBy("LoanStatus"))">
                                            Final Loan Status @GetSortIcon("LoanStatus")
                                        </th>
                                        <th @onclick="@(() => SortBy("ArchivedDate"))">
                                            Archived Date @GetSortIcon("ArchivedDate")
                                        </th>
                                        <th @onclick="@(() => SortBy("TotalPaid"))">
                                            Total Paid @GetSortIcon("TotalPaid")
                                        </th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var customer in GetPagedCustomers())
                                    {
                                        <tr class="archive-row @GetArchiveRowClass(customer.LoanStatus)">
                                            <td>
                                                <input type="checkbox" @bind="customer.IsSelected" />
                                            </td>
                                            <td class="customer-name">
                                                <div class="name-cell">
                                                    <div class="customer-avatar-small">@GetInitials(customer.Name)</div>
                                                    <div class="name-info">
                                                        <strong>@customer.Name</strong>
                                                        <small>@customer.Email</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="employment">
                                                <span class="employment-badge @GetEmploymentClass(customer.Employment)">
                                                    @customer.Employment
                                                </span>
                                            </td>
                                            <td class="loan-status">
                                                <span class="status-badge @GetLoanStatusClass(customer.LoanStatus)">
                                                    @customer.LoanStatus
                                                </span>
                                            </td>
                                            <td class="archived-date">
                                                @customer.ArchivedDate.ToString("MMM dd, yyyy")
                                            </td>
                                            <td class="total-paid">
                                                <strong>@customer.TotalPaid.ToString("C0")</strong>
                                            </td>
                                            <td class="archive-actions">
                                                <div class="action-buttons">
                                                    <button class="btn-icon" title="View Details" @onclick="() => ViewArchiveDetails(customer)">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                                            <circle cx="12" cy="12" r="3"/>
                                                        </svg>
                                                    </button>
                                                    <button class="btn-icon" title="Restore Customer" @onclick="() => RestoreCustomer(customer)">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <polyline points="23,4 23,10 17,10"/>
                                                            <polyline points="1,20 1,14 7,14"/>
                                                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                                                        </svg>
                                                    </button>
                                                    <button class="btn-icon delete" title="Permanently Delete" @onclick="() => PermanentlyDelete(customer)">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <polyline points="3,6 5,6 21,6"/>
                                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="pagination">
                            <div class="pagination-info">
                                <span>Showing @((currentPage * pageSize) + 1) to @Math.Min((currentPage + 1) * pageSize, GetFilteredCustomers().Count) of @GetFilteredCustomers().Count entries</span>
                            </div>
                            <div class="pagination-controls">
                                <button class="page-btn" @onclick="PreviousPage" disabled="@(currentPage == 0)">Previous</button>
                                <div class="page-numbers">
                                    @for (int i = 0; i < totalPages; i++)
                                    {
                                        int pageNum = i;
                                        <button class="page-btn @(currentPage == i ? "active" : "")" @onclick="() => GoToPage(pageNum)">@(i + 1)</button>
                                    }
                                </div>
                                <button class="page-btn" @onclick="NextPage" disabled="@(currentPage >= totalPages - 1)">Next</button>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    }
    else if (activeTab == "loans")
    {
        <!-- Loan Archive Content -->
        <div class="archive-content">
            <div class="empty-container">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        <line x1="12" y1="18" x2="12" y2="22"/>
                    </svg>
                </div>
                <h4>No archived loans</h4>
                <p>There are no archived loans at the moment.</p>
            </div>
        </div>
    }
    else if (activeTab == "payments")
    {
        <!-- Payment Archive Content -->
        <div class="archive-content">
            <div class="empty-container">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                </div>
                <h4>No archived payments</h4>
                <p>There are no archived payments at the moment.</p>
            </div>
        </div>
    }
</div>

@code {
    // Archive Customer Model
    public class ArchivedCustomerModel
    {
        public string Id { get; set; } = "";
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string Phone { get; set; } = "";
        public string Employment { get; set; } = "";
        public string LoanStatus { get; set; } = "";
        public DateTime ArchivedDate { get; set; } = DateTime.Now;
        public decimal TotalPaid { get; set; }
        public string ArchiveReason { get; set; } = "";
        public bool IsSelected { get; set; } = false;
    }

    // State Management
    private List<ArchivedCustomerModel> allArchivedCustomers = new();
    
    private string activeTab = "customers";
    private bool isLoading = false;
    
    // Customer Archive State
    private string customerSearchTerm = "";
    private string selectedEmployment = "All Employment";
    private string selectedLoanStatus = "All Loan Status";
    private string selectedArchivePeriod = "All Archive Period";
    private string viewMode = "table";
    private int currentPage = 0;
    private int pageSize = 10;
    private int totalPages => (int)Math.Ceiling((double)GetFilteredCustomers().Count / pageSize);
    private string sortColumn = "Name";
    private bool sortAscending = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadArchiveData();
    }

    private async Task LoadArchiveData()
    {
        isLoading = true;
        
        // Sample archived customer data
        allArchivedCustomers = new List<ArchivedCustomerModel>
        {
            new ArchivedCustomerModel 
            { 
                Id = "ARCH-2024-001",
                Name = "Robert Johnson",
                Email = "robert.johnson@email.com",
                Phone = "+1 (555) 123-4567",
                Employment = "Retired",
                LoanStatus = "Completed",
                ArchivedDate = new DateTime(2024, 11, 15),
                TotalPaid = 55000,
                ArchiveReason = "Loan completed successfully"
            },
            new ArchivedCustomerModel 
            { 
                Id = "ARCH-2024-002",
                Name = "Maria Garcia",
                Email = "maria.garcia@email.com",
                Phone = "+1 (555) 234-5678",
                Employment = "Self-Employed",
                LoanStatus = "Completed",
                ArchivedDate = new DateTime(2024, 10, 30),
                TotalPaid = 32000,
                ArchiveReason = "Early loan completion"
            },
            new ArchivedCustomerModel 
            { 
                Id = "ARCH-2024-003",
                Name = "James Wilson",
                Email = "james.wilson@email.com",
                Phone = "+1 (555) 345-6789",
                Employment = "Unemployed",
                LoanStatus = "Defaulted",
                ArchivedDate = new DateTime(2024, 09, 22),
                TotalPaid = 8500,
                ArchiveReason = "Loan defaulted"
            }
        };
        
        isLoading = false;
    }

    // Tab Management
    private void SetActiveTab(string tab)
    {
        activeTab = tab;
        StateHasChanged();
    }

    // Archive Count Methods
    private int GetArchivedCustomersCount()
    {
        return allArchivedCustomers.Count;
    }

    private int GetArchivedLoansCount()
    {
        return 0; // Placeholder
    }

    private int GetArchivedPaymentsCount()
    {
        return 0; // Placeholder
    }

    // Search and Filter Methods
    private async Task HandleCustomerSearch(ChangeEventArgs e)
    {
        customerSearchTerm = e.Value?.ToString() ?? "";
        currentPage = 0;
        await Task.CompletedTask;
    }

    private List<ArchivedCustomerModel> GetFilteredCustomers()
    {
        var customers = allArchivedCustomers.AsQueryable();
        
        // Apply search filter
        if (!string.IsNullOrEmpty(customerSearchTerm))
        {
            customers = customers.Where(c => 
                c.Name.Contains(customerSearchTerm, StringComparison.OrdinalIgnoreCase) ||
                c.Email.Contains(customerSearchTerm, StringComparison.OrdinalIgnoreCase) ||
                c.Id.Contains(customerSearchTerm, StringComparison.OrdinalIgnoreCase));
        }
        
        // Apply employment filter
        if (selectedEmployment != "All Employment")
        {
            customers = customers.Where(c => c.Employment == selectedEmployment);
        }
        
        // Apply loan status filter
        if (selectedLoanStatus != "All Loan Status")
        {
            customers = customers.Where(c => c.LoanStatus == selectedLoanStatus);
        }
        
        // Apply archive period filter
        if (selectedArchivePeriod != "All Archive Period")
        {
            var now = DateTime.Now;
            customers = selectedArchivePeriod switch
            {
                "This Month" => customers.Where(c => c.ArchivedDate >= now.AddMonths(-1)),
                "Last 3 Months" => customers.Where(c => c.ArchivedDate >= now.AddMonths(-3)),
                "Last 6 Months" => customers.Where(c => c.ArchivedDate >= now.AddMonths(-6)),
                "Last Year" => customers.Where(c => c.ArchivedDate >= now.AddYears(-1)),
                _ => customers
            };
        }

        // Apply sorting
        customers = sortColumn switch
        {
            "Name" => sortAscending ? customers.OrderBy(c => c.Name) : customers.OrderByDescending(c => c.Name),
            "Employment" => sortAscending ? customers.OrderBy(c => c.Employment) : customers.OrderByDescending(c => c.Employment),
            "LoanStatus" => sortAscending ? customers.OrderBy(c => c.LoanStatus) : customers.OrderByDescending(c => c.LoanStatus),
            "ArchivedDate" => sortAscending ? customers.OrderBy(c => c.ArchivedDate) : customers.OrderByDescending(c => c.ArchivedDate),
            "TotalPaid" => sortAscending ? customers.OrderBy(c => c.TotalPaid) : customers.OrderByDescending(c => c.TotalPaid),
            _ => customers.OrderBy(c => c.Name)
        };
        
        return customers.ToList();
    }

    private List<ArchivedCustomerModel> GetPagedCustomers()
    {
        var filteredCustomers = GetFilteredCustomers();
        return filteredCustomers.Skip(currentPage * pageSize).Take(pageSize).ToList();
    }

    // Utility Methods
    private string GetInitials(string name)
    {
        if (string.IsNullOrEmpty(name)) 
            return "AC";
        
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
        {
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        }
        else if (parts.Length == 1 && parts[0].Length >= 2)
        {
            return parts[0].Substring(0, 2).ToUpper();
        }
        
        return "AC";
    }

    private string GetArchiveRowClass(string loanStatus)
    {
        return loanStatus.ToLower() switch
        {
            "completed" => "archive-completed",
            "defaulted" => "archive-defaulted",
            "closed" => "archive-closed",
            _ => ""
        };
    }

    private string GetEmploymentClass(string employment)
    {
        return employment.ToLower().Replace(" ", "-").Replace("-", "");
    }

    private string GetLoanStatusClass(string loanStatus)
    {
        return loanStatus.ToLower() switch
        {
            "completed" => "status-completed",
            "defaulted" => "status-defaulted",
            "closed" => "status-closed",
            _ => "status-default"
        };
    }

    // Sorting Methods
    private void SortBy(string column)
    {
        if (sortColumn == column)
        {
            sortAscending = !sortAscending;
        }
        else
        {
            sortColumn = column;
            sortAscending = true;
        }
        StateHasChanged();
    }

    private string GetSortIcon(string column)
    {
        if (sortColumn != column) return "??";
        return sortAscending ? "??" : "??";
    }

    // View and Pagination Methods
    private void SetViewMode(string mode)
    {
        viewMode = mode;
        StateHasChanged();
    }

    private async Task UpdatePageSize(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newSize))
        {
            pageSize = newSize;
            currentPage = 0;
            StateHasChanged();
        }
        await Task.CompletedTask;
    }

    private void PreviousPage()
    {
        if (currentPage > 0)
        {
            currentPage--;
            StateHasChanged();
        }
    }

    private void NextPage()
    {
        if (currentPage < totalPages - 1)
        {
            currentPage++;
            StateHasChanged();
        }
    }

    private void GoToPage(int page)
    {
        currentPage = page;
        StateHasChanged();
    }

    // Selection Methods
    private void SelectAll(ChangeEventArgs e)
    {
        bool isChecked = e.Value is bool value && value;
        foreach (var customer in GetPagedCustomers())
        {
            customer.IsSelected = isChecked;
        }
        StateHasChanged();
    }

    // Action Methods
    private void ExportArchiveData()
    {
        Console.WriteLine("Exporting archive data...");
    }

    private void RestoreSelected()
    {
        var selectedCustomers = allArchivedCustomers.Where(c => c.IsSelected).ToList();
        Console.WriteLine($"Restoring {selectedCustomers.Count} customers...");
    }

    private void RefreshArchive()
    {
        Console.WriteLine("Refreshing archive data...");
        StateHasChanged();
    }

    private void ViewArchiveDetails(ArchivedCustomerModel customer)
    {
        Console.WriteLine($"Viewing comprehensive archive details for: {customer.Name}");
        
        // Show detailed archived customer information
        var details = new {
            ArchivedCustomer = customer,
            ArchiveInfo = new {
                ArchiveId = customer.Id,
                CustomerName = customer.Name,
                ArchivedDate = customer.ArchivedDate.ToString("MMM dd, yyyy"),
                ArchiveReason = customer.ArchiveReason,
                ArchiveDuration = CalculateArchiveDuration(customer.ArchivedDate)
            },
            OriginalAccountInfo = new {
                Email = customer.Email,
                Phone = customer.Phone,
                Employment = customer.Employment,
                FinalLoanStatus = customer.LoanStatus,
                TotalPaid = customer.TotalPaid.ToString("C")
            },
            FinancialSummary = new {
                TotalRevenue = customer.TotalPaid.ToString("C"),
                EstimatedLifetimeValue = CalculateLifetimeValue(customer).ToString("C"),
                ProfitabilityScore = CalculateProfitabilityScore(customer),
                ReturnOnInvestment = CalculateROI(customer) + "%"
            },
            ArchiveMetrics = new {
                RetentionPeriod = "7 years (regulatory requirement)",
                StorageLocation = "Secure archive database",
                DataIntegrity = "Verified",
                ComplianceStatus = "Compliant",
                LastVerification = DateTime.Now.AddDays(-30).ToString("MMM dd, yyyy")
            },
            RestoreOptions = new {
                CanRestore = true,
                RestoreProcess = "Contact administrator for restoration",
                DataAvailability = "Full historical data available",
                EstimatedRestoreTime = "24-48 hours"
            },
            LegalConsiderations = new {
                RetentionPolicy = "Retain for 7 years per banking regulations",
                PurgeDate = customer.ArchivedDate.AddYears(7).ToString("MMM dd, yyyy"),
                PrivacyCompliance = "GDPR/CCPA compliant",
                AuditTrail = "Complete audit trail maintained"
            }
        };
        
        Console.WriteLine($"Archive Details: {System.Text.Json.JsonSerializer.Serialize(details, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })}");
    }

    private void RestoreCustomer(ArchivedCustomerModel customer)
    {
        Console.WriteLine($"Initiating restoration process for customer: {customer.Name}");
        
        // Process customer restoration with detailed workflow
        var restorationProcess = new {
            Customer = customer,
            RestorationRequest = new {
                RequestId = Guid.NewGuid().ToString(),
                RequestDate = DateTime.Now,
                RequestedBy = "Admin User",
                Priority = "Normal",
                EstimatedCompletionTime = DateTime.Now.AddDays(2)
            },
            PreRestoreChecks = new {
                DataIntegrityCheck = "Passed",
                ComplianceVerification = "Passed",
                SystemCompatibility = "Compatible",
                ConflictResolution = "No conflicts detected"
            },
            RestorationSteps = new[] {
                new { Step = 1, Action = "Validate archived data", Status = "Completed", Duration = "5 minutes" },
                new { Step = 2, Action = "Prepare restoration environment", Status = "In Progress", Duration = "15 minutes" },
                new { Step = 3, Action = "Restore customer profile", Status = "Pending", Duration = "30 minutes" },
                new { Step = 4, Action = "Restore transaction history", Status = "Pending", Duration = "1 hour" },
                new { Step = 5, Action = "Update system references", Status = "Pending", Duration = "30 minutes" },
                new { Step = 6, Action = "Verify restoration", Status = "Pending", Duration = "15 minutes" }
            },
            NotificationPlan = new {
                NotifyCustomer = true,
                NotifyTeam = true,
                NotificationMethod = "Email + SMS",
                CustomMessage = $"Customer {customer.Name} account has been restored and is now active."
            },
            PostRestorationTasks = new {
                ReactivateServices = true,
                UpdateCreditProfile = true,
                ScheduleFollowUp = true,
                DocumentRestoration = true
            }
        };
        
        Console.WriteLine($"Restoration Process: {System.Text.Json.JsonSerializer.Serialize(restorationProcess, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })}");
        
        // Remove from archive list (in real app, would move back to active customers)
        allArchivedCustomers.Remove(customer);
        StateHasChanged();
    }

    private void PermanentlyDelete(ArchivedCustomerModel customer)
    {
        Console.WriteLine($"Initiating permanent deletion process for customer: {customer.Name}");
        
        // Process permanent deletion with detailed compliance workflow
        var deletionProcess = new {
            Customer = customer,
            DeletionRequest = new {
                RequestId = Guid.NewGuid().ToString(),
                RequestDate = DateTime.Now,
                RequestedBy = "Admin User",
                AuthorizationRequired = true,
                ComplianceOfficerApproval = "Required"
            },
            PreDeletionChecks = new {
                LegalRetentionPeriod = customer.ArchivedDate.AddYears(7) < DateTime.Now ? "Expired" : "Still in retention period",
                RegulatoryCompliance = "Under review",
                OutstandingObligations = "None",
                LegalHolds = "None active"
            },
            DeletionScope = new {
                CustomerProfile = "Will be permanently deleted",
                TransactionHistory = "Will be permanently deleted",
                CommunicationRecords = "Will be permanently deleted", 
                AuditTrail = "Will be retained per regulatory requirements",
                BackupCopies = "Will be purged from all systems"
            },
            ComplianceRequirements = new {
                RegulatoryApproval = "Required for permanent deletion",
                AuditDocumentation = "Complete documentation required",
                CustomerNotification = customer.ArchivedDate.AddYears(7) < DateTime.Now ? "Not required (retention expired)" : "Required",
                DataProcessorNotification = "Required for third-party processors"
            },
            SafetyMeasures = new {
                BackupCreated = "Encrypted backup created for legal purposes",
                AuthorizationLog = "All authorizations logged",
                IrreversibilityWarning = "This action cannot be undone",
                FinalConfirmation = "Required before execution"
            }
        };
        
        Console.WriteLine($"Deletion Process: {System.Text.Json.JsonSerializer.Serialize(deletionProcess, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })}");
        
        // In a real implementation, this would require additional approvals and safeguards
        // For demo purposes, we'll just remove from the list
        Console.WriteLine("WARNING: In a real system, this would require compliance officer approval and cannot be undone.");
        
        allArchivedCustomers.Remove(customer);
        StateHasChanged();
    }

    // Helper methods for archive analysis
    private string CalculateArchiveDuration(DateTime archiveDate)
    {
        var duration = DateTime.Now - archiveDate;
        return $"{duration.Days} days ({duration.Days / 30} months)";
    }
    
    private decimal CalculateLifetimeValue(ArchivedCustomerModel customer)
    {
        // Estimate based on total paid and average customer metrics
        return customer.TotalPaid * 1.2m; // 20% markup for estimated lifetime value
    }
    
    private string CalculateProfitabilityScore(ArchivedCustomerModel customer)
    {
        // Simple scoring based on total paid amount
        return customer.TotalPaid switch
        {
            > 50000 => "High",
            > 25000 => "Medium",
            _ => "Low"
        };
    }
    
    private string CalculateROI(ArchivedCustomerModel customer)
    {
        // Estimate ROI based on total paid (assuming average loan amount)
        var estimatedLoanAmount = customer.TotalPaid / 0.8m; // Assuming 80% repayment rate
        var profit = customer.TotalPaid - estimatedLoanAmount;
        return estimatedLoanAmount > 0 ? ((profit / estimatedLoanAmount) * 100).ToString("F1") : "0";
    }
}